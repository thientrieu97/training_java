<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{product/layout}">
<head>
    <meta charset="UTF-8">
    <title>Upload product</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>

        // upload file to imgbb.com
        function uploadFile(file) {
            let formData = new FormData();
            formData.append("image", file);

            $.ajax({
                url: "https://api.imgbb.com/1/upload?key=0a2f694b33e70dc6d06249c85fa8bb63",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log(data.data.url);
                    let img_url = document.getElementById("image_url");
                    img_url.value = data.data.url;
                    validateForm();
                },
                error: function (data) {
                    console.log("error");
                    console.log(data);
                }
            });
        }

        // File onchange event
        function fileChange() {
            const file = document.getElementById("image_file").files[0];
            uploadFile(file);
        }

        function validateForm() {
            // event.preventDefault();
            console.log("validateForm");
            let btnSubmit = document.getElementById("upload_product");
            let name = document.forms["upload"]["name"].value;
            let price = document.forms["upload"]["price"].value;
            let quantity = document.forms["upload"]["quantity"].value;
            let image_url = document.forms["upload"]["image_url"].value;
            btnSubmit.disabled = name.length === 0 || price.length === 0 || quantity.length === 0 || image_url.length === 0;
        }

    </script>
</head>
<div layout:fragment="content">
    <body onload="validateForm()">
    <header>
        <h1>Upload a Product</h1>
    </header>
    <main>
        <form th:action="@{/admin/product/upload}" method="post" enctype="multipart/form-data" id="upload"
              oninput="validateForm()">
            <label for="name">Product Name:</label>
            <input type="text" id="name" name="name" th:required="true">
            <br>
            <label for="price">Price:</label>
            <input type="number" id="price" name="price" th:required="true">
            <br>
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" th:required="true">
            <br>
            <label for="image_file">Image File:</label>
            <input type="file" id="image_file" onchange="fileChange()" accept="image/*" th:required="true">
            <!--        <br>-->
            <label for="image_url"></label>
            <input id="image_url" type="text" name="image_url" th:required="true">
            <br>
            <input type="submit" value="Upload" id="upload_product" disabled="disabled">
        </form>
    </main>
    <footer>
        <p>&copy; 2023 MyStore. All rights reserved.</p>
    </footer>

    </body>
</div>
</html>